# =============================================================================
# templates/alert-rules.yml.j2 - Alert rules template (optional)
# =============================================================================

# {{ ansible_managed }}
# Prometheus alert rules
# Generated by Ansible prometheus role

groups:
{% for group in prometheus_alert_rules %}
  - name: {{ group.name }}
{% if group.interval is defined %}
    interval: {{ group.interval }}
{% endif %}
    rules:
{% for rule in group.rules %}
      - alert: {{ rule.alert }}
        expr: {{ rule.expr }}
{% if rule.for is defined %}
        for: {{ rule.for }}
{% endif %}
{% if rule.keep_firing_for is defined %}
        keep_firing_for: {{ rule.keep_firing_for }}
{% endif %}
{% if rule.labels is defined %}
        labels:
{% for key, value in rule.labels.items() %}
          {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
{% if rule.annotations is defined %}
        annotations:
{% for key, value in rule.annotations.items() %}
          {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
{% endfor %}
{% endfor %}

{% if prometheus_recording_rules | length > 0 %}
# Recording rules
{% for group in prometheus_recording_rules %}
  - name: {{ group.name }}
{% if group.interval is defined %}
    interval: {{ group.interval }}
{% endif %}
    rules:
{% for rule in group.rules %}
      - record: {{ rule.record }}
        expr: {{ rule.expr }}
{% if rule.labels is defined %}
        labels:
{% for key, value in rule.labels.items() %}
          {{ key }}: "{{ value }}"
{% endfor %}
{% endif %}
{% endfor %}
{% endfor %}
{% endif %}